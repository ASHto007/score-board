<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styleApp.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="https://kit.fontawesome.com/d2d502b6ae.js" crossorigin="anonymous"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <title>Score Keeper App</title>
</head>

<body>
    <div id="root"></div>
    <script type="text/babel">
        let hit = null;
        let teamOneScore = 0;
        let teamTwoScore = 0;
        let teamOneWickets = 0;
        let teamTwoWickets = 0;
        let currentTeam = 1; // 1 for Team 1, 2 for Team 2
        let comment = React.createRef();
        let ballWiseResult = [];
        let extraScore = 0;
        let currentOver = [];
        let teamOneOvers = [];
        let teamTwoOvers = [];
        let ballsInOver = 0;
        let warningMessage = '';
        let showOverWiseResult = false;

        function addScore(num) {
            hit = num;
            warningMessage = '';
            rootElement.render(<App />);
        }

        function wicket() {
            hit = 'W';
            warningMessage = '';
            rootElement.render(<App />);
        }

        function wideBall() {
            hit = 'Wd';
            warningMessage = '';
            extraScore = 0;
            rootElement.render(<App />);
        }

        function noBall() {
            hit = 'Nb';
            warningMessage = '';
            extraScore = 0;
            rootElement.render(<App />);
        }

        function addExtraRuns(num) {
            extraScore = num;
            rootElement.render(<App />);
        }

        function toggleTeam() {
            // Save the current over data to the respective team's overs array
            if (currentTeam === 1) {
                if (currentOver.length > 0) teamOneOvers.push(currentOver);
                currentTeam = 2;
            } else {
                if (currentOver.length > 0) teamTwoOvers.push(currentOver);
                currentTeam = 1;
            }

            // Reset the current over and ball count for the new team
            currentOver = [];
            ballsInOver = 0;

            rootElement.render(<App />);
        }

        function toggleOverWiseResult() {
            showOverWiseResult = !showOverWiseResult;
            rootElement.render(<App />);
        }

        function ScoreButtons() {
            return (
                <div id='runs'>
                    <h3>Run Buttons</h3>
                    <div>
                        <button onClick={() => addScore(0)}>0</button>
                        <button onClick={() => addScore(1)}>1</button>
                        <button onClick={() => addScore(2)}>2</button>
                        <button onClick={() => addScore(3)}>3</button>
                        <button onClick={() => addScore(4)}>4</button>
                        <button onClick={() => addScore(6)}>6</button>
                    </div>
                    <div className="dial-pad">
                        <button onClick={wideBall}>Wide</button>
                        <button onClick={wicket}>Wicket</button>
                        <button onClick={noBall}>No Ball</button>
                    </div>
                </div>
            );
        }

        function ExtraRunsButtons() {
            return (
                <div id='extraRuns'>
                    <div>
                        <p>Runs scored off the extra delivery:</p>
                    </div>
                    <div>
                        <button onClick={() => addExtraRuns(0)}>0</button>
                        <button onClick={() => addExtraRuns(1)}>1</button>
                        <button onClick={() => addExtraRuns(2)}>2</button>
                        <button onClick={() => addExtraRuns(3)}>3</button>
                        <button onClick={() => addExtraRuns(4)}>4</button>
                        <button onClick={() => addExtraRuns(6)}>6</button>
                    </div>
                </div>
            );
        }

        function handleEvent(event) {
            event.preventDefault();
            if (hit === '' || hit === null) {
                warningMessage = 'Please select a valid score before submitting.';
                rootElement.render(<App />);
                return;
            }

            let animationClass = '';
            let hitClass = '';

            if (hit === 'W') {
                if (currentTeam === 1) {
                    teamOneWickets += 1;
                } else {
                    teamTwoWickets += 1;
                }
                currentOver.push(`${hit}`);
                ballsInOver += 1;
                animationClass = 'wicket-animation';
                hitClass = 'wicket-animation';
                ballWiseResult.unshift({ hit, comment: comment.current.value, animationClass: hitClass });
            } else if (hit === 'Nb' || hit === 'Wd') {
                if (currentTeam === 1) {
                    teamOneScore += 1 + extraScore; // One extra run for the delivery plus runs scored off it
                } else {
                    teamTwoScore += 1 + extraScore;
                }
                currentOver.push(`${hit}+${extraScore}`);
                hitClass = hit === 'Wd' ? 'extra-animation-wide' : 'extra-animation-no-ball';
                animationClass = hit === 'Wd' ? 'wideBallAnimation' : 'extraAnimationNoBall';
                ballWiseResult.unshift({ hit: `${hit} + ${extraScore}`, comment: comment.current.value, animationClass: animationClass });
            } else {
                if (currentTeam === 1) {
                    teamOneScore += hit;
                } else {
                    teamTwoScore += hit;
                }
                currentOver.push(`${hit}`);
                hitClass = hit === 4 ? 'hit-4' : hit === 6 ? 'hit-6' : '';
                animationClass = hit === 4 ? 'hit4Animation' : hit === 6 ? 'hit6Animation' : '';
                ballWiseResult.unshift({ hit, comment: comment.current.value, animationClass: hitClass });
                ballsInOver += 1;
            }

            // Check if over is completed
            if (ballsInOver >= 6) {
                console.log('Over completed. Adding to overs array.');
                if (currentTeam === 1) {
                    teamOneOvers.push(currentOver);
                } else {
                    teamTwoOvers.push(currentOver);
                }
                currentOver = []; // Reset current over
                ballsInOver = 0;  // Reset balls in over
            }

            // Reset hit and extraScore for the next input
            hit = '';
            extraScore = 0;
            comment.current.value = ''; // Reset comment input field
            warningMessage = '';
            rootElement.render(<App />);
        }

        const Form = () => (
            <form onSubmit={handleEvent}>
                <div id="input">
                    <input type="text" value={hit || ''} readOnly />
                </div>
                <div id='formBtn'>
                    <button type="submit">Submit</button>
                </div>
                {warningMessage && <p style={{ color: 'red' }}>{warningMessage}</p>}
            </form>
        );

        const OverWiseResult = () => (
            <div className="overWiseResult">
                <h3>Over-wise Results</h3>
                <div>
                    <h4>Team 1:</h4>
                    {teamOneOvers.length === 0 && <p>No overs yet.</p>}
                    {teamOneOvers.map((over, index) => (
                        <div key={index}>
                            <strong>Over {index + 1}:</strong> 
                            {over.map((item, i) => (
                                <span key={i} className={getAnimationClass(item)}>
                                    {item}&nbsp;
                                </span>
                            ))}
                        </div>
                    ))}
                    {currentTeam === 1 && currentOver.length > 0 && (
                        <div>
                            <strong>Current Over:</strong> 
                            {currentOver.map((item, i) => (
                                <span key={i} className={getAnimationClass(item)}>
                                    {item}&nbsp;
                                </span>
                            ))}
                        </div>
                    )}
                </div>
                <div>
                    <h4>Team 2:</h4>
                    {teamTwoOvers.length === 0 && <p>No overs yet.</p>}
                    {teamTwoOvers.map((over, index) => (
                        <div key={index}>
                            <strong>Over {index + 1}:</strong> 
                            {over.map((item, i) => (
                                <span key={i} className={getAnimationClass(item)}>
                                    {item}&nbsp;
                                </span>
                            ))}
                        </div>
                    ))}
                    {currentTeam === 2 && currentOver.length > 0 && (
                        <div>
                            <strong>Current Over:</strong> 
                            {currentOver.map((item, i) => (
                                <span key={i} className={getAnimationClass(item)}>
                                    {item}&nbsp;
                                </span>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        );

        function getAnimationClass(item) {
            if (String(item).includes('4')) return 'over-wise-hit-4';
            if (String(item).includes('6')) return 'over-wise-hit-6';
            if (String(item).includes('W')) return 'over-wise-wicket';
            if (String(item).includes('Wd')) return 'over-wise-wide';
            if (String(item).includes('Nb')) return 'over-wise-no-ball';
            return '';
        }

        function finishMatch() {
            // Reset all states
            hit = null;
            teamOneScore = 0;
            teamTwoScore = 0;
            teamOneWickets = 0;
            teamTwoWickets = 0;
            currentTeam = 1;
            ballWiseResult = [];
            extraScore = 0;
            currentOver = [];
            teamOneOvers = [];
            teamTwoOvers = [];
            ballsInOver = 0;
            warningMessage = '';

            rootElement.render(<App />);
        }

        function App() {
            return (
                <div className="app">
                    <h2>Score Keeper App</h2>
                    <div id='extraBtn'>
                        <button onClick={toggleTeam} id='toggleBtn'><i class="fa-solid fa-user-plus"></i></button>
                        <button onClick={toggleOverWiseResult}>
                            {showOverWiseResult ? "Hide Over-wise Result" : "Show Over-wise Result"}
                        </button>
                        <button onClick={finishMatch} id='toggleBtn'><i class="fa-regular fa-circle-check"></i></button>
                    </div>
                    <div className="score">
                        <div className={`team1 ${currentTeam === 1 ? 'active-team' : ''}`}>
                            <h4>Team 1 Score </h4>
                            <h4>Score: {teamOneScore}/{teamOneWickets}</h4>
                        </div>
                        <div className={`team2 ${currentTeam === 2 ? 'active-team' : ''}`}>
                            <h4>Team 2 Score</h4>
                            <h4>Score: {teamTwoScore}/{teamTwoWickets}</h4>
                        </div>
                    </div>
                    
                    <ScoreButtons />
                    {(hit === 'Nb' || hit === 'Wd') && <ExtraRunsButtons />}
                    <Form />
                    {showOverWiseResult && <OverWiseResult />}
                </div>
            );
        }

        const rootElement = ReactDOM.createRoot(document.getElementById('root'));
        rootElement.render(<App />);
    </script>
</body>

</html>
